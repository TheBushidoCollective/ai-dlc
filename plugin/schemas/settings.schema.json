{
	"$schema": "http://json-schema.org/draft-07/schema#",
	"$id": "https://han.guru/schemas/ai-dlc-settings.schema.json",
	"title": "AI-DLC Settings",
	"description": "Configuration schema for .ai-dlc/settings.yml files that configure AI-DLC behavior including VCS strategy",
	"type": "object",
	"properties": {
		"git": {
			"$ref": "#/definitions/vcsConfig",
			"description": "VCS configuration when using Git"
		},
		"jj": {
			"$ref": "#/definitions/vcsConfig",
			"description": "VCS configuration when using Jujutsu (jj)"
		},
		"providers": {
			"$ref": "#/definitions/providersConfig",
			"description": "External system providers for spec, ticketing, design, and comms"
		}
	},
	"additionalProperties": false,
	"definitions": {
		"providersConfig": {
			"type": "object",
			"description": "External system provider configuration",
			"properties": {
				"spec": {
					"$ref": "#/definitions/specProviderEntry",
					"description": "Specification/documentation provider (Notion, Confluence, Google Docs)"
				},
				"ticketing": {
					"$ref": "#/definitions/ticketingProviderEntry",
					"description": "Ticketing/issue tracking provider (Jira, Linear, GitHub Issues, GitLab Issues)"
				},
				"design": {
					"$ref": "#/definitions/designProviderEntry",
					"description": "Design tool provider (Figma)"
				},
				"comms": {
					"$ref": "#/definitions/commsProviderEntry",
					"description": "Communication provider (Slack, Teams, Discord)"
				}
			},
			"additionalProperties": false
		},
		"specProviderEntry": {
			"type": "object",
			"description": "A configured specification/documentation provider",
			"properties": {
				"type": {
					"type": "string",
					"enum": ["notion", "confluence", "google-docs"],
					"description": "Specification provider type"
				},
				"config": {
					"type": "object",
					"description": "Provider-specific configuration — schema determined by provider type"
				},
				"instructions": {
					"type": "string",
					"description": "Inline provider instructions (merged with built-in defaults and project overrides)"
				}
			},
			"required": ["type"],
			"additionalProperties": false,
			"allOf": [
				{
					"if": { "properties": { "type": { "const": "notion" } } },
					"then": { "properties": { "config": { "$ref": "providers/notion.schema.json" } } }
				},
				{
					"if": { "properties": { "type": { "const": "confluence" } } },
					"then": { "properties": { "config": { "$ref": "providers/confluence.schema.json" } } }
				}
			]
		},
		"ticketingProviderEntry": {
			"type": "object",
			"description": "A configured ticketing/issue tracking provider",
			"properties": {
				"type": {
					"type": "string",
					"enum": ["jira", "linear", "github-issues", "gitlab-issues"],
					"description": "Ticketing provider type"
				},
				"config": {
					"type": "object",
					"description": "Provider-specific configuration — schema determined by provider type"
				},
				"instructions": {
					"type": "string",
					"description": "Inline provider instructions (merged with built-in defaults and project overrides)"
				}
			},
			"required": ["type"],
			"additionalProperties": false,
			"allOf": [
				{
					"if": { "properties": { "type": { "const": "jira" } } },
					"then": { "properties": { "config": { "$ref": "providers/jira.schema.json" } } }
				},
				{
					"if": { "properties": { "type": { "const": "linear" } } },
					"then": { "properties": { "config": { "$ref": "providers/linear.schema.json" } } }
				},
				{
					"if": { "properties": { "type": { "const": "github-issues" } } },
					"then": { "properties": { "config": { "$ref": "providers/github-issues.schema.json" } } }
				},
				{
					"if": { "properties": { "type": { "const": "gitlab-issues" } } },
					"then": { "properties": { "config": { "$ref": "providers/gitlab-issues.schema.json" } } }
				}
			]
		},
		"designProviderEntry": {
			"type": "object",
			"description": "A configured design tool provider",
			"properties": {
				"type": {
					"type": "string",
					"enum": ["figma"],
					"description": "Design provider type"
				},
				"config": {
					"type": "object",
					"description": "Provider-specific configuration — schema determined by provider type"
				},
				"instructions": {
					"type": "string",
					"description": "Inline provider instructions (merged with built-in defaults and project overrides)"
				}
			},
			"required": ["type"],
			"additionalProperties": false,
			"allOf": [
				{
					"if": { "properties": { "type": { "const": "figma" } } },
					"then": { "properties": { "config": { "$ref": "providers/figma.schema.json" } } }
				}
			]
		},
		"commsProviderEntry": {
			"type": "object",
			"description": "A configured communication provider",
			"properties": {
				"type": {
					"type": "string",
					"enum": ["slack", "teams", "discord"],
					"description": "Communication provider type"
				},
				"config": {
					"type": "object",
					"description": "Provider-specific configuration — schema determined by provider type"
				},
				"instructions": {
					"type": "string",
					"description": "Inline provider instructions (merged with built-in defaults and project overrides)"
				}
			},
			"required": ["type"],
			"additionalProperties": false,
			"allOf": [
				{
					"if": { "properties": { "type": { "const": "slack" } } },
					"then": { "properties": { "config": { "$ref": "providers/slack.schema.json" } } }
				}
			]
		},
		"vcsConfig": {
			"type": "object",
			"description": "Version control system configuration",
			"properties": {
				"change_strategy": {
					"type": "string",
					"enum": ["trunk", "unit", "intent"],
					"default": "unit",
					"description": "How changes are organized:\n- trunk: All work on main branch, no feature branches\n- unit: One branch per unit, each gets its own MR reviewed individually (default)\n- intent: One long-lived branch per intent, agents build autonomously via DAG ordering"
				},
				"elaboration_review": {
					"type": "boolean",
					"default": true,
					"description": "Whether to create a pull request for elaborated intent review before planning"
				},
				"default_branch": {
					"type": "string",
					"default": "auto",
					"description": "The default/main branch name. Set to 'auto' to detect from remote (origin/HEAD), or specify explicitly (e.g., 'main', 'master', 'develop')"
				},
				"auto_merge": {
					"type": "boolean",
					"description": "Whether to automatically merge completed unit branches. Only applies to 'unit' and 'intent' strategies."
				},
				"auto_squash": {
					"type": "boolean",
					"description": "Whether to squash commits when merging. Only applies when auto_merge is enabled."
				}
			},
			"additionalProperties": false
		}
	}
}
